#+TITLE: Python
#+HTML_LINK_UP: index.html
#+HTML_LINK_HOME: index.html
#+OPTIONS: ^:{}

* URL encoding/decoding

#+BEGIN_SRC python
  >>> s = u'1234567890-/:;()$&@".,?!\'[]{}#%^*+=_\|~<>\u20ac\xa3\xa5\u2022.,?!\''
  >>> urllib2.quote(s.encode("utf8"))
  '1234567890-/%3A%3B%28%29%24%26%40%22.%2C%3F%21%27%5B%5D%7B%7D%23%25%5E%2A%2B%3D_%5C%7C%7E%3C%3E%E2%82%AC%C2%A3%C2%A5%E2%80%A2.%2C%3F%21%27'
#+END_SRC

  Remember that you will need to both unquote() and decode() this to print it out properly if you're debugging or whatever.

#+BEGIN_SRC python
  >>> print urllib2.unquote(urllib2.quote(s.encode("utf8")))
  1234567890-/:;()$&@".,?!'[]{}#%^*+=_\|~<>â‚¬Â£Â¥â€¢.,?!'
  >>> # oops, nasty Â means we've got a utf8 byte stream being treated as an ascii stream
  >>> print urllib2.unquote(urllib2.quote(s.encode("utf8"))).decode("utf8")
  1234567890-/:;()$&@".,?!'[]{}#%^*+=_\|~<>€£¥•.,?!'
#+END_SRC

* CGI

** 读取提交数据
   #+BEGIN_SRC python
     form = cgi.FieldStorage()
     name = form.getfirst("name")
     namelist = form.getlist("name")
   #+END_SRC

* MySQL
  插入datetime
  #+BEGIN_SRC python
    time.strftime('%Y-%m-%d %H:%M:%S')
  #+END_SRC

** Commit
   MySQLdb的autocommit是默认关闭的，[[http://www.python.org/dev/peps/pep-0249/][PEP 249 -- Python Database API Specification v2.0]]推荐我们要显示地commit或者rollback。

   记得在哪本书里面看到，一次commit或者rollback意味着下一个事务的开始，如果我们没有指定begin的话。

* 根据字符串import
  #+BEGIN_SRC python
    def import_object(name):
        """Imports an object by name.

        import_object('x.y.z') is equivalent to 'from x.y import z'.

        >>> import tornado.escape
        >>> import_object('tornado.escape') is tornado.escape
        True
        >>> import_object('tornado.escape.utf8') is tornado.escape.utf8
        True
        """
        parts = name.split('.')
        obj = __import__('.'.join(parts[:-1]), None, None, [parts[-1]], 0)
        return getattr(obj, parts[-1])
  #+END_SRC
  这个是在Tornado源码中看到的，觉得挺好用的。

  其中用到了__import__这个函数

  #+BEGIN_EXAMPLE
    __import__(name, globals={}, locals={}, fromlist=[], level=-1) -> module
  #+END_EXAMPLE

  如果fromlist为空，那么会返回第一层包，例如os.path会返回os。如果非空，就返回之后的一个部分，如path。

  [[http://stackoverflow.com/questions/211100/pythons-import-doesnt-work-as-expected][Python's __import__ doesn't work as expected]]

  [[http://stackoverflow.com/questions/2724260/why-does-pythons-import-require-fromlist][Why does Python's __import__ require fromlist?]]

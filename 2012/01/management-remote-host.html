
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>管理远程主机的一些技巧分享 - My Octopress Blog</title>
  <meta name="author" content="Stupid ET">

  
  <meta name="description" content="对于管理远程主机，我想大家都一般使用ssh吧，在本地是Linux的环境下，那么都是挺方便的，什么都不需要弄就可以用 ssh -l username hostname 来登录远程主机。而在Windows上，虽然有专门的ssh客户端，不过在cygwin里面还是挺亲切的。对于cygwin， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://cedricporter.github.com/2012/01/management-remote-host.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:cedricporter.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">管理远程主机的一些技巧分享</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-20T21:11:18+08:00" pubdate data-updated="true">2012-01-20</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>对于管理远程主机，我想大家都一般使用ssh吧，在本地是Linux的环境下，那么都是挺方便的，什么都不需要弄就可以用</p>

<p>ssh -l username hostname</p>

<p>来登录远程主机。而在Windows上，虽然有专门的ssh客户端，不过在cygwin里面还是挺亲切的。对于cygwin，我们可以设置在安装的时候选上OpenSSH，这样就可以方便地在Windows上使用ssh了，当然还有很多非常棒的工具可以选择安装，在国内选择163的镜像速度还是挺快的。</p>

<h3>每次登陆都要密码？免口令SSH登陆！</h3>

<p>我们可以创建创建公钥和密钥来实现免口令登陆，公钥放到服务器那里，这样在登陆的时候只要公钥密钥匹配正确就可以不需要输入密码了。</p>

<p>好，现在我们来创建公钥和密钥，我们使用ssh-keygen来生成。</p>

<figure class='code'><figcaption><span>bash  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ssh-keygen
</span><span class='line'>Generating public/private rsa key pair.
</span><span class='line'>Enter file in which to save the key <span class="o">(</span>/home/Cedric Porter/.ssh/id_rsa<span class="o">)</span>:
</span><span class='line'>Enter passphrase <span class="o">(</span>empty <span class="k">for </span>no passphrase<span class="o">)</span>:
</span><span class='line'>Enter same passphrase again:
</span><span class='line'>Your identification has been saved in id_rsa_test.
</span><span class='line'>Your public key has been saved in id_rsa_test.pub.
</span><span class='line'>The key fingerprint is:
</span><span class='line'>60:7c:f3:42:58:57:42:1f:dc:65:e2:05:3d:49:54:02 Cedric Porter@CedricPorter-PC
</span><span class='line'>The key<span class="err">&#39;</span>s randomart image is:
</span><span class='line'>+--<span class="o">[</span> RSA 2048<span class="o">]</span>----+
</span><span class='line'>|        ..+oEo**B|
</span><span class='line'>|     . o . o.o.B.|
</span><span class='line'>|      <span class="o">=</span> +   . . .|
</span><span class='line'>|     . + o       |
</span><span class='line'>|        S .      |
</span><span class='line'>|         .       |
</span><span class='line'>|                 |
</span><span class='line'>|                 |
</span><span class='line'>|                 |
</span><span class='line'>+-----------------+
</span></code></pre></td></tr></table></div></figure>


<p>然后我们就在我们的HOME目录下的.ssh目录下创建了公钥密钥对。<!-- more -->
我们可以看到</p>

<figure class='code'><figcaption><span>bash  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Cedric Porter@CedricPorter-PC ~/.ssh
</span><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>id_rsa  id_rsa.pub  known_hosts
</span></code></pre></td></tr></table></div></figure>


<p>其中，id_rsa为我们的密钥，id_rsa.pub为我们的公钥，我们把公钥写到服务器那里的.ssh目录下的authorized_keys里面</p>

<figure class='code'><figcaption><span>bash  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Cedric Porter@CedricPorter-PC ~/.ssh
</span><span class='line'><span class="nv">$ </span>scp ~/.ssh/id_rsa.pub root@everet.org:~/.ssh/authorized_keys
</span></code></pre></td></tr></table></div></figure>


<p>然后以后我们的ssh和scp都不需要再输入密码了。</p>

<h3>每次都要打 ssh -l root everet.org，很烦，使用缩写！</h3>

<p>我们可以使用别名，例如，我们可以把 alias et=&#8217;ssh -l root everet.org&#8217; 写入到HOME目录下的.bashrc中，利用别名完成。也可以把登录命令写到一个在环境变量的路径中的一个文件中，例如写到/usr/bin下。</p>

<figure class='code'><figcaption><span>bash  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;alias et=&#39;ssh -l root everet.org&#39;&quot;</span> &gt;&gt; ~/.bashrc
</span><span class='line'><span class="nv">$ </span><span class="c"># 或者用下面的命令</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;ssh -l root everet.org&quot;</span> &gt; /usr/bin/et
</span><span class='line'><span class="nv">$ </span>chmod +x /usr/bin/et
</span><span class='line'><span class="err">$</span>
</span><span class='line'><span class="nv">$ </span><span class="c"># 以后就可以使用et来登录了</span>
</span><span class='line'>Cedric Porter@CedricPorter-PC ~
</span><span class='line'><span class="nv">$ </span>et
</span><span class='line'>Linux localhost.localdomain 2.6.33.4-95.fc13.i686.PAE <span class="c">#1 SMP Thu May 13 05:38:26 UTC 2010 i686 GNU/Linux</span>
</span><span class='line'>Ubuntu 10.10
</span><span class='line'>
</span><span class='line'>Welcome to Ubuntu!
</span><span class='line'> * Documentation:  https://help.ubuntu.com/
</span><span class='line'>Last login: Fri Jan 20 10:55:50 2012 from 123.65.146.220
</span><span class='line'>root@localhost:~#
</span></code></pre></td></tr></table></div></figure>


<h3>断线，丢失之前的工作！？用screen解决ssh的断线重连问题</h3>

<h1>screen -ls</h1>

<p>可以查看现在有的screen，如果找不到命令可以使用apt-get install screen，更详细的说明请见IBM网站的教程</p>

<p><a href="http://www.ibm.com/developerworks/cn/linux/l-cn-screen/">http://www.ibm.com/developerworks/cn/linux/l-cn-screen/</a></p>

<p>一般我们登录后，我们可以使用 screen -S et 来新建一个screen，于是当我们断线后，我们可以重新连接使用 screen -r et 恢复之前的会话。这个很好，当我们需要断开连接去睡觉时，可以让工作继续。所以必要时我们应该使用screen来管理我们的会话。</p>

<h3>与服务器同步数据</h3>

<p>对于同步数据，发现rsync还是相当不错滴。rsync是由Andrew Trigdell和Paul Macherras编写的，其思想与rdist类似，不过侧重点不同。rsync有点儿像加强版的rcp，同步时可以保存权限等信息，还可以增量复制。</p>

<h4>下面我们来讨论下在Ubuntu下开启rsync。</h4>

<ol>
<li><p>我们修改/etc/default/rsync，让它可以在开机自启动。我们将其中的RSYNC_ENABLE=false改为RSYNC_ENABLE=true即可。</p></li>
<li><p>设置rsync。配置文件在/etc/rsyncd.conf，如果不存着则创建一个，如创建一个配置文件，vi /etc/rsyncd.conf 。</p></li>
<li><p>输入下面内容</p></li>
</ol>


<blockquote><p>[et_wordpress]
path = /var/www/et
secrets file = /etc/rsyncd.secrets
read only = false
uid = root
gid = root</p></blockquote>

<p>打完收工！现在重启开启rsync的daemon，输入 /etc/init.d/rsync start 。OK！</p>

<h4>现在让我们来在同步数据。</h4>

<p>把服务器的数据下载回来，我现在在Windows上，使用cygwin，例如，我把的我的wordpress的文件同步回来，可以使用下述命令：</p>

<blockquote><p>rsync -vzrtopg &#8211;delete &#8211;progress   everet.org::et_wordpress   /cygdrive/h/Coding/everet/et</p></blockquote>

<p>当我在本地修改了文件，我可以把我的文件push到服务器上面：</p>

<blockquote><p>rsync -vzrtopg &#8211;delete &#8211;progress  /cygdrive/h/Coding/everet/et/*   everet.org::et_wordpress</p></blockquote>

<p>每次都输入那么一长串命令很麻烦吧？我们可以参看上面的第二个标题的使用缩写命令来完成。</p>

<blockquote><p>echo &#8220;rsync -vzrtopg &#8211;delete &#8211;progress   everet.org::et_wordpress   /cygdrive/h/Coding/everet/et&#8221; > /usr/bin/rcet
echo &#8220;rsync -vzrtopg &#8211;delete &#8211;progress /cygdrive/h/Coding/everet/et/* everet.org::et_wordpress&#8221; > /usr/bin/rcet2</p></blockquote>

<p>然后我们就可以使用 rcet 来下载服务器的数据，用 rcet2 来把本地的数据推送到服务器。</p>

<p>对于我在cygwin下，每次推送到服务器是文件的属主会发生变化，所以我们在推送完后还需要修改属主，这个在cygwin会出现，不知在纯Linux下会不会，不过应该不会滴。如果出现文件属主改变的问题我们可以在推送完后修改下文件属主。</p>

<blockquote><p>ssh -l root everet.org &#8220;chown www-data:www-data -R /var/www/et&#8221;</p></blockquote>

<h4>好，我们把它加到我们的推送数据的别名缩写中。修改 /usr/bin/rcet2 文件内容为：</h4>

<blockquote><p>rsync -vzrtopg &#8211;delete &#8211;progress /cygdrive/h/Coding/everet/et/* everet.org::et_wordpress
ssh -l root everet.org &#8220;chown www-data:www-data -R /var/www/et&#8221;
echo &#8220;Done.&#8221;</p></blockquote>

<p>我们就可以方便地推送数据了。</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Stupid ET</span></span>

      








  


<time datetime="2012-01-20T21:11:18+08:00" pubdate data-updated="true">2012-01-20</time>
      

<span class="categories">
  
    <a class='category' href='/categories/技术类/'>技术类</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://cedricporter.github.com/2012/01/management-remote-host.html" data-via="" data-counturl="http://cedricporter.github.com/2012/01/management-remote-host.html" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2012/01/low-memory-vps-configuration.html" title="Previous Post: 低内存VPS的配置">&laquo; 低内存VPS的配置</a>
      
      
        <a class="basic-alignment right" href="/2012/01/scar.html" title="Next Post: 我们的游戏 Scar">我们的游戏 Scar &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/12/e8b083e8af95nginx.html">调试Nginx</a>
      </li>
    
      <li class="post">
        <a href="/2012/12/moinmoin-as-kms-by-nginx-uwsgi.html">MoinMoin+Nginx+uWSGI搭建个人Wiki</a>
      </li>
    
      <li class="post">
        <a href="/2012/12/hardware-decide-the-software.html">有什么样的硬件，用什么样的软件</a>
      </li>
    
      <li class="post">
        <a href="/2012/11/vps-host-disappear.html">VPS主机商跑路了</a>
      </li>
    
      <li class="post">
        <a href="/2012/11/multi-user-nginx-php-server.html">配置多用户的虚拟主机</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/cedricporter">@cedricporter</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'cedricporter',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Stupid ET -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'everet';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://cedricporter.github.com/2012/01/management-remote-host.html';
        var disqus_url = 'http://cedricporter.github.com/2012/01/management-remote-host.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

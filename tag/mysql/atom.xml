<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: Mysql | EverET.org]]></title>
  <link href="http://everet.org/tag/mysql/atom.xml" rel="self"/>
  <link href="http://everet.org/"/>
  <updated>2013-01-03T13:14:59+08:00</updated>
  <id>http://everet.org/</id>
  <author>
    <name><![CDATA[Stupid ET]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Ubuntu下自动异地备份数据库]]></title>
    <link href="http://everet.org/2012/06/ubuntu-mysql-backup.html"/>
    <updated>2012-06-10T03:57:02+08:00</updated>
    <id>http://everet.org/2012/06/ubuntu-mysql-backup</id>
    <content type="html"><![CDATA[<p>想必大家自己用<a href="http://everet.org/2012/06/ubuntu-mysql-backup.html">VPS</a>的时候，可能对人工备份都不那么勤快。但是备份确实十分的重要，当服务器硬盘彻底废了、数据库被骇客篡改，此时备份就显得格外的重要。</p>

<p>特别是对于还承载着别人的VPS，我们更需要做好备份。像<a href="http://www.kidsang.com/">屠文翔同学</a>将自己辛苦翻译《Game Engine Architecture》贴在wordpress博客上，万一哪天服务器的数据库废了，文章找不到了，我该如何面对屠文翔同学啊，所以备份就必不可少了。</p>

<p>我们或许只要一次编程的努力就可以让日后的备份一劳永逸。</p>

<p>嗯，我们可以用脚本将整个数据库dump下来变成文件，放在服务器上作为备份，这样的本地备份万一服务器的数据遭遇了不可恢复的灾难那就悲剧了。所以我们可以寻求异地备份，将备份放置到其他机器上面。</p>

<h2 id="section">异地备份</h2>

<h3 id="more---">方法一<!-- more --></h3>

<p>我们有空的时候，打开自己的电脑，然后从服务器上面将备份下载回自己的电脑保存。</p>

<p>评论：这样的方法未免有点2B，而且效率实在太低。备份的版本还需要自己保存。真是麻烦。</p>

<h3 id="section-1">方法二</h3>

<p>让服务器将数据库备份到其他服务器上面。</p>

<p>评论：这方法不错，怎么可以比较廉价地实施呢？</p>

<p>我们可以用邮件将我们的数据库备份发送到自己的邮箱。</p>

<p>像Gmail有10GB的空间，QQ邮箱更是无限容量，不够了可以免费扩容。于是乎，邮箱是个非常好的异地备份存放点。而且邮件本来就是一封一封的，我们可以方便地将不同时期的版本下回来比较。此外，我们还可以在邮箱设置收件规则，自动将我们的备份邮件标记为已读并放置到分类到备份文件夹中，这样就不会扰乱我们的正常邮件了。</p>

<h2 id="section-2">实施</h2>

<p>我们可以使用Python来把数据库dump下来，然后压缩，发送到自己的邮箱。然后周期性运行我们可以借助cron按照时间表来运行我们的备份任务。</p>

<h3 id="cron">cron</h3>

<p>首先我们看看如果配置cron运行我们的周期性备份。</p>

<p>cron的配置文件是<strong>/etc/crontab</strong></p>

<p>每个非注释行代表一个命令：</p>

<blockquote>
  <p><em>minute hour day month weekday username command</em></p>
</blockquote>

<p>我们可以加入如下行，</p>

<blockquote>
  <p>30 4 * * 1,3,4 root /etc/apache2/db/backup.py</p>
</blockquote>

<p>意思是每周一三四凌晨4点30分运行我们的备份程序。</p>

<p>修改完配置后我们重启一下cron。</p>

<blockquote>
  <p>service cron restart</p>
</blockquote>

<h3 id="python">Python</h3>

<p>下面的Python代码是备份整个数据库，然后将备份以附件形式发送到指定邮箱。</p>

<p>我们在用mysqldump将数据库dump下来后再用gzip压缩一下，对于我们的数据库原来是35MB，用gzip压缩后就只有5MB，小了很多。</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>python  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c"># website: http://EverET.org</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">smtplib</span><span class="o">,</span> <span class="nn">os</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">email.MIMEMultipart</span> <span class="kn">import</span> <span class="n">MIMEMultipart</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">email.MIMEBase</span> <span class="kn">import</span> <span class="n">MIMEBase</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">email.MIMEText</span> <span class="kn">import</span> <span class="n">MIMEText</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">email.Utils</span> <span class="kn">import</span> <span class="n">COMMASPACE</span><span class="p">,</span> <span class="n">formatdate</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">email</span> <span class="kn">import</span> <span class="n">Encoders</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">subprocess</span><span class="o">,</span> <span class="nn">time</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">def</span> <span class="nf">send_mail</span><span class="p">(</span><span class="n">send_from</span><span class="p">,</span> <span class="n">send_to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span>
</span><span class='line'>        <span class="n">files</span><span class="o">=</span><span class="p">[],</span> <span class="n">server</span><span class="o">=</span><span class="err">”</span><span class="n">localhost</span><span class="err">”</span><span class="p">):</span>
</span><span class='line'>    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">send_to</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span>
</span><span class='line'>    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>
</span><span class='line'><span class="n">msg</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">send_from</span>
</span><span class='line'><span class="n">msg</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">COMMASPACE</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">send_to</span><span class="p">)</span>
</span><span class='line'><span class="n">msg</span><span class="p">[</span><span class="s">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatdate</span><span class="p">(</span><span class="n">localtime</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'><span class="n">msg</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
</span><span class='line'>
</span><span class='line'><span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span class='line'>    <span class="n">part</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="s">&#39;application&#39;</span><span class="p">,</span> <span class="s">&quot;octet-stream&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">part</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="s">&quot;rb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="p">)</span>
</span><span class='line'>    <span class="n">Encoders</span><span class="o">.</span><span class="n">encode_base64</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
</span><span class='line'>    <span class="n">part</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;attachment; filename=&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span>
</span><span class='line'>            <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</span><span class='line'>    <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">smtp</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
</span><span class='line'><span class="n">smtp</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">send_from</span><span class="p">,</span> <span class="n">send_to</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
</span><span class='line'><span class="n">smtp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">def</span> <span class="nf">backup</span><span class="p">():</span>
</span><span class='line'>    <span class="n">passwd</span><span class="o">=</span><span class="err">”</span><span class="n">your</span> <span class="n">password</span><span class="err">”</span>
</span><span class='line'>    <span class="n">user</span><span class="o">=</span><span class="err">’</span><span class="n">root</span><span class="err">’</span>
</span><span class='line'>    <span class="n">ret</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span>
</span><span class='line'>            <span class="err">‘</span><span class="s">&#39;’mysqldump -u </span><span class="si">%s</span><span class="s"> -p”</span><span class="si">%s</span><span class="s">” –all-databases |</span>
</span><span class='line'>            <span class="n">gzip</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apache2</span><span class="o">/</span><span class="n">db</span><span class="o">/</span><span class="nb">all</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">gz</span><span class="err">’’’</span>
</span><span class='line'>            <span class="o">%</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">passwd</span><span class="p">),</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">ret</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">if</span> <span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">name</span><span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span> <span class="o">==</span> <span class="err">‘</span><span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">main</span><span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span><span class="err">’</span><span class="p">:</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">backup</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>        <span class="n">send_mail</span><span class="p">(</span>
</span><span class='line'>            <span class="err">‘</span><span class="n">et</span><span class="nd">@everet.org</span><span class="err">’</span><span class="p">,</span>        <span class="c"># from mail</span>
</span><span class='line'>            <span class="p">[</span><span class="err">‘</span><span class="n">your</span><span class="nd">@mail.com</span><span class="err">’</span><span class="p">],</span>   <span class="c"># to mail</span>
</span><span class='line'>            <span class="err">‘</span><span class="nb">all</span> <span class="n">database</span> <span class="n">backup</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>            <span class="err">‘</span><span class="n">backup</span> <span class="n">time</span><span class="p">:</span><span class="o">%</span><span class="n">s</span><span class="err">’</span>
</span><span class='line'>            <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">()),</span> <span class="p">),</span>
</span><span class='line'>            <span class="p">[</span><span class="err">‘</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apache2</span><span class="o">/</span><span class="n">db</span><span class="o">/</span><span class="nb">all</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">gz</span><span class="err">’</span><span class="p">])</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span> <span class="err">‘</span><span class="n">error</span><span class="err">’</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>因为我们数据库的密码是写在了脚本里面，所以我们需要修改权限，让仅自己可读，以提高安全性。</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>bash  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>chmod 700 backup.py
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[数据库的一些基本概念]]></title>
    <link href="http://everet.org/2012/02/some-basic-concepts-of-database.html"/>
    <updated>2012-02-20T08:30:54+08:00</updated>
    <id>http://everet.org/2012/02/some-basic-concepts-of-database</id>
    <content type="html"><![CDATA[<p>可能很多初学者对于数据库没有什么概念。</p>

<p>对于MySQL来说，其下可以有很多个数据库，可以使用</p>

<blockquote>

  <p>CREATE DATABASE database_name;</p>
</blockquote>

<p>来建数据库。</p>

<p>我们还可以对不同的数据库对不同的用户设置权限。</p>

<p>然后我们可以选择当前操作的数据库，然后在其下建表</p>

<blockquote>

  <p>CREATE TABLE table_name;</p>
</blockquote>

<p>举个例子，我们可以在MySQL下一些数据库：ET，LST，zhke，test。</p>

<p>然后在数据库ET下有两张表User和Product。</p>

<!-- more -->

<p>在数据库zhke下有三张表User、Article和comment。</p>

<p><a href="http://everet.org/wp-content/uploads/2012/02/image11.png"><img src="http://everet.org/wp-content/uploads/2012/02/image_thumb11.png" alt="image" /></a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[低内存VPS的配置]]></title>
    <link href="http://everet.org/2012/01/low-memory-vps-configuration.html"/>
    <updated>2012-01-20T05:36:01+08:00</updated>
    <id>http://everet.org/2012/01/low-memory-vps-configuration</id>
    <content type="html"><![CDATA[<p>十几天前和隔壁宿舍的伟大的晓彬同学一起低价购置了一台二手电脑摆在宿舍做服务器，处理器虽然只有1.6Ghz，不过至少也有1G的内存可用。装了Ubuntu Server 11.10，机箱后面只是插了电源和网线，因为木有钱，所有就不买显示器，不过买了也占位置。另外，因为学校是华南地区教育网的接入点，所以我们每人端口都有一个公网的固定IP，这是做服务器的良好条件啊~这个真是太幸福啦~</p>

<p>不过寒假回家了，宿舍的服务器总不能开着吧，到时把宿舍烧了就悲剧了:-( 。于是乎，还是租个虚拟服务器比较靠谱。</p>

<p>在两天前奖学金终于到了，于是便下手买了VPS，原因有很多，主要就是要有一台常开的机器来服务我们这些人类。其实发现有台在国外的VPS确实挺好的，最主要的就是可以提供VPN。自己从零开始搭建服务器，既是机遇也是挑战啊~</p>

<p>好，现在回忆一下如何搭建这个网站。<!-- more --></p>

<h2 id="section"><strong>必要的话可以修改时区</strong></h2>

<p>cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</p>

<h2 id="section-1"><strong>内存小，增加虚拟内存</strong></h2>

<p>如何增加虚拟内存呢？这个在《鸟哥的Linux私房菜》里面说了有比较详细的说明，这里也简要提一下。</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>bash  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="err">$</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /var
</span><span class='line'><span class="nv">$ </span><span class="c"># 生成一个256MB的文件，262144 = 256 * 1024 = 256K</span>
</span><span class='line'><span class="nv">$ </span>dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/var/swapfile <span class="nv">bs</span><span class="o">=</span>1024 <span class="nv">count</span><span class="o">=</span>262144
</span><span class='line'><span class="nv">$ </span><span class="c"># mkswap可将磁盘分区或文件设为Linux的交换区</span>
</span><span class='line'><span class="nv">$ </span>mkswap /var/swapfile
</span><span class='line'><span class="nv">$ </span><span class="c"># 启动系统交换区(swap area)</span>
</span><span class='line'><span class="nv">$ </span>swapon /var/swapfile
</span><span class='line'><span class="nv">$ </span><span class="c"># 显示交换区的使用状况</span>
</span><span class='line'><span class="nv">$ </span>swapon -s
</span><span class='line'><span class="nv">$&lt;</span>/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2 id="vpn"><strong>搭建VPN</strong></h2>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>bash  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;binbash&quot;</span>&gt;!/bin/bash&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;apt-get update
</span><span class='line'>apt-get -y install ppp pptpd iptables
</span><span class='line'><span class="c"># 设置DNS</span>
</span><span class='line'><span class="nb">echo </span>ms-dns 208.67.222.222 » /etc/ppp/pptpd-options
</span><span class='line'><span class="nb">echo </span>ms-dns 208.67.220.220 » /etc/ppp/pptpd-options
</span><span class='line'><span class="nb">echo </span>localip 192.168.99.1 » /etc/pptpd.conf
</span><span class='line'><span class="nb">echo </span>remoteip 192.168.99.9-99 » /etc/pptpd.conf
</span><span class='line'><span class="c"># 设置防火墙</span>
</span><span class='line'><span class="c"># 如果出现restorecon command not found，可以apt-get install policycoreutils</span>
</span><span class='line'>iptables -t nat -A POSTROUTING -s 192.168.99.0/24 -j MASQUERADE
</span><span class='line'><span class="c"># 加到rc.local让开机会重新设置过滤</span>
</span><span class='line'>sed -i ‘s/exit<span class="se">\ </span>0/#exit<span class="se">\ </span>0/’ /etc/rc.local
</span><span class='line'><span class="nb">echo </span>iptables -t nat -A POSTROUTING -s 192.168.99.0/24 <span class="se">\</span>
</span><span class='line'>-j MASQUERADE » /etc/rc.local
</span><span class='line'><span class="nb">echo exit </span>0 » /etc/rc.local
</span><span class='line'><span class="nb">echo </span>net.ipv4.ip_forward <span class="o">=</span> 1 » /etc/sysctl.conf
</span><span class='line'>sysctl -p
</span><span class='line'><span class="c"># 添加用户test_user，密码test_password</span>
</span><span class='line'><span class="c"># 格式</span>
</span><span class='line'><span class="c">#  client        server     secret                IP addresses</span>
</span><span class='line'><span class="nb">echo </span>test_user * test_password * » /etc/ppp/chap-secrets
</span><span class='line'><span class="c"># 其中IP地址这一列，我们可以为特定用户手工指定特定IP。</span>
</span><span class='line'><span class="c"># 如果没有指定，为”*“，那么PPTP VPN服务器从/etc/pptp.conf文件中</span>
</span><span class='line'><span class="c"># 我们设定的remoteip中选择一个分配给客户端。&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'>&lt;h1 <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;pptpd&quot;</span>&gt;重启pptpd让设置生效&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;/etc/init.d/pptpd restart&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2 id="section-2">搭建邮件服务器</h2>

<p>apt-get install sendmail, 然后就可以用sendmail somebody@qq.com发送邮件了，这里还没有讲述如何配置收件，不过发件可以了。收件配置稍后在补全。</p>

<p>apt-get install postfix
apt-get install mailutils</p>

<h2 id="web"><strong>配置Web服务器</strong></h2>

<p>虽然我还是挺想用Apache的，不过太占资源了，所以还是用轻量级一点的nginx，日后有空再自己写个更简单轻量的。整体配置为 Linux + Nginx + PHP-fpm + Mysql，也是传说中的 LNMP。这个在Ubuntu 10.10上搭建还是灰常简单滴。</p>

<p>我们可以使用下列命令完成安装</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>bash  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;apt-get update
</span><span class='line'>apt-get install mysql-server
</span><span class='line'>apt-get install nginx
</span><span class='line'>apt-get install php5-cgi php5-mysql php5-fpm php5-curl php5-gd <span class="se">\</span>
</span><span class='line'>php5-idn php-pear php5-imagick php5-imap php5-mcrypt <span class="se">\</span>
</span><span class='line'>php5-memcache php5-mhash php5-ming php5-pspell <span class="se">\</span>
</span><span class='line'>php5-recode php5-snmp php5-tidy php5-xmlrpc php5-xsl&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>然后就可以用 service –status-all 查看所有的服务。
我们可以用 vi /etc/php5/fpm/php.ini 修改php的配置。可以加上 cgi.fix_pathinfo=0 这句，因为可能会导致可以上传图片扩展名的php，然后可以通过路径访问执行php，如果出现这种情况那就悲剧了。
好，现在我们开始配置nginx，我们可以 vi /etc/nginx/sites-available/default 编辑</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>text  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;server {
</span><span class='line'>	listen   80; ## listen for ipv4
</span><span class='line'>		listen   [::]:80 default ipv6only=on; ## listen for ipv6
</span><span class='line'>		server_name  www.everet.org everet.org;
</span><span class='line'>	access_log  /var/log/nginx/et/localhost.access.log;
</span><span class='line'>	location / {
</span><span class='line'>		if (!-f $request_filename){
</span><span class='line'>			rewrite (.*) /index.php;
</span><span class='line'>		}
</span><span class='line'>		root   /var/www/et;
</span><span class='line'>		index  index.php index.html index.htm;
</span><span class='line'>	}
</span><span class='line'>	location ~ .php$ {
</span><span class='line'>		fastcgi_pass   127.0.0.1:9000;
</span><span class='line'>		fastcgi_index  index.php;
</span><span class='line'>		fastcgi_param  SCRIPT_FILENAME  /var/www/et$fastcgi_script_name;
</span><span class='line'>		include		 fastcgi_params;
</span><span class='line'>	}
</span><span class='line'>}&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>然后就完成了基本的配置。</p>
]]></content>
  </entry>
  
</feed>
